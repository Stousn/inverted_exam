-- ************************************************************************************************
-- Tabellen erstellen und Beziehungen festlegen
-- ************************************************************************************************

-- HOTFIX: MySQL haut es (trotz CASCADE), wenn das eigeschalten bleibt. Da eh alles gelöscht wird, ist es so sogar performanter
SET FOREIGN_KEY_CHECKS = 0;

CREATE OR REPLACE TABLE COUNTRY(
	ID INT(255) AUTO_INCREMENT PRIMARY KEY,
	CODE VARCHAR(2),
	NAME VARCHAR(255)
);

-- Welche Städte gibt es
CREATE OR REPLACE TABLE CITY(
	ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
	NAME VARCHAR(255),
  FK_Country_ID INT(255)
);

-- Welche Strecken gibt es

CREATE OR REPLACE TABLE TRACK(
	ID INT(255) AUTO_INCREMENT PRIMARY KEY,
	NAME VARCHAR(255),
  LENGTH VARCHAR(255),
  FASTEST_LAP VARCHAR(255),
  SEATS INT(255),
  FK_City_ID INT(255)
);

-- Welche Rennen gibt es

CREATE OR REPLACE TABLE RACE(
  ID INT(255) NOT NULL AUTO_INCREMENT,
  LAPS VARCHAR(255), 
  START_TIME VARCHAR(255),
  DURATION VARCHAR(255),
  R_DATE DATE, 
  FK_Track_ID INT(255),
  PRIMARY KEY (ID)
);


-- Welche Strecken gibt es

CREATE OR REPLACE TABLE DRIVER(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  FORNAME VARCHAR(255),
  LASTNAME VARCHAR(255),
  DOB DATE,
  WEIGHT INT(255),
  FK_Country_ID INT(255),
  FK_Team_ID INT(255)
);

-- Welche Teams gibt es

CREATE OR REPLACE TABLE TEAM(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
  NAME VARCHAR(255),
  FK_Brand_ID INT(255)
);

-- Welche Marken gibt es

CREATE OR REPLACE TABLE BRAND(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
  NAME VARCHAR(255)
);

-- Welche Position hat welcher Fahrer bei welchem Rennen erreicht

CREATE OR REPLACE TABLE RACE_TO_DRIVER(
  RACE_ID INT(255) NOT NULL,
  DRIVER_ID INT(255) NOT NULL,
  POSITION INT(255) NOT NULL
);

-- In der Beziehungstabelle dürfen nur IDs vorkommen die es auch gibt
ALTER TABLE CITY ADD FOREIGN KEY (FK_Country_ID) REFERENCES COUNTRY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE TRACK ADD FOREIGN KEY (FK_City_ID) REFERENCES CITY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE RACE ADD FOREIGN KEY (FK_Track_ID) REFERENCES TRACK(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE DRIVER ADD FOREIGN KEY (FK_Country_ID) REFERENCES COUNTRY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE DRIVER ADD FOREIGN KEY (FK_Team_ID) REFERENCES TEAM(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE TEAM ADD FOREIGN KEY (FK_Brand_ID) REFERENCES BRAND(ID) ON DELETE CASCADE ON UPDATE CASCADE;

-- Keine Doppelten Einträge
ALTER TABLE RACE_TO_DRIVER ADD CONSTRAINT NO_DUPL_PD UNIQUE (RACE_ID, DRIVER_ID);


SET FOREIGN_KEY_CHECKS = 1;
-- END OF HOTFIX ;)

-- ************************************************************************************************
-- Es ist an der Zeit einige Daten einzufüllen
-- ************************************************************************************************
-- Alle Länder
INSERT INTO COUNTRY (CODE, NAME) VALUES ('DE', 'GERMANY');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('AT', 'AUSTRIA');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('HU', 'HUNGARY');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('NL', 'NETHERLANDS');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('GB', 'GREAT BRITAN');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('RU', 'RUSSIA');

-- Alle Städte
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('HOK','Hockenheim','1');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('SPI','Spielberg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('LAU','Lausitz','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('NUB','Nürnberg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('ZAN','Zandvoort','4');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('MOS','Moscow','6');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('NUR','Nürburg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('BUD','Budapest','3');

-- Alle Strecken
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Hockenheimring','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Red Bull Ring','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Eurospeedway Lausitz','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Norisring','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Zandvoort','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Moscow Raceway','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Nürburgring','4,574km','1:32,532', '120.000');
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS) VALUES('Budapest','4,574km','1:32,532', '120.000');

-- Alle Marken
INSERT INTO BRAND (ID, CODE, NAME) VALUES (1, 'MER', 'Mercedes Benz');
INSERT INTO BRAND (ID, CODE, NAME) VALUES (2, 'BMW', 'BMW');
INSERT INTO BRAND (ID, CODE, NAME) VALUES (3, 'AUD', 'Audi');

-- Alle Teams
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ABT', 'Audi Sport Team Abt Sportsline', 3);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('PHO', 'Audi Sport Team Phoenix', 3);       
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ROS', 'Audi Sport Team Rosberg', 3);       
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('RBM', 'BMW Team RBM', 2);                  
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('RMG', 'BMW Team RMG', 2);                  
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('MTE', 'BMW Team MTEK', 2);                 
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('SCH', 'BMW Team Schnitzer', 2);            
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ART', 'Mercedes-AMG DTM Team ART', 1);     
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('HWA', 'Mercedes-AMG DTM Team HWA', 1);     
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('MUE', 'Mercedes-AMG DTM Team Mücke', 1);    

-- Alle Fahrer: Team Zuweisung, Gewicht und DOB sind zufällig und entsprechen nicht der Realität
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Lucas', 'Auer', '14.07.1978', '70KG', 1, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Tom', 'Blomqvist', '14.07.1978', '70KG', 2, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Mattias', 'Ekström', '14.07.1978', '70KG', 3, 3);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Augusto', 'Farfus', '14.07.1978', '70KG', 4, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('António', 'Félix da Costa', '14.07.1978', '70KG', 5, 5);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Paul', 'Di Resta', '14.07.1978', '70KG', 1, 6);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Timo', 'Glock', '14.07.1978', '70KG', 2, 7);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Maximilian', 'Götz', '14.07.1978', '70KG', 3, 8);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Jamie', 'Green', '14.07.1978', '70KG', 4, 9);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Daniel', 'Juncadella', '14.07.1978', '70KG', 5, 10);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Maxime', 'Martin', '14.07.1978', '70KG', 1, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Miguel', 'Molina', '14.07.1978', '70KG', 2, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Edoardo', 'Mortara', '14.07.1978', '70KG', 3, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Nico', 'Müller', '14.07.1978', '70KG', 4, 3);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Esteban', 'Ocon', '14.07.1978', '70KG', 5, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Gary', 'Paffett', '14.07.1978', '70KG', 1, 5);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Mike', 'Rockenfeller', '14.07.1978', '70KG', 2, 6);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Timo', 'Scheider', '14.07.1978', '70KG', 3, 7);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Bruno', 'Spengler', '14.07.1978', '70KG', 4, 8);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Adrien', 'Tambay', '14.07.1978', '70KG', 5, 9);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Martin', 'Tomczyk', '14.07.1978', '70KG', 1, 10);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Christian', 'Vietoris', '14.07.1978', '70KG', 2, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Robert', 'Wickens', '14.07.1978', '70KG', 3, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Marco', 'Wittmann', '14.07.1978', '70KG', 4, 3);


-- Alle Rennen
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('30', '13:30', '40min', '1.5.2016', '1');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('40', '15:00', '1h', '2.5.2016', '1');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('31', '13:30', '40min', '20.5.2016', '2');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('41', '15:00', '1h', '21.5.2016', '2');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('32', '13:30', '40min', '30.5.2016', '3');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('42', '15:00', '1h', '1.6.2016', '3');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('33', '13:30', '40min', '21.6.2016', '4');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('43', '15:00', '1h', '22.6.2016', '4');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('34', '13:30', '40min', '10.7.2016', '5');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('44', '15:00', '1h', '11.7.2016', '5');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('35', '13:30', '40min', '28.7.2016', '6');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('45', '15:00', '1h', '19.7.2016', '6');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('36', '13:30', '40min', '5.8.2016', '7');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('46', '15:00', '1h', '6.8.2016', '7');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('37', '13:30', '40min', '25.8.2016', '8');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('47', '15:00', '1h', '26.8.2016', '8');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('30', '13:30', '40min', '3.9.2016', '1');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES ('40', '15:00', '1h', '4.9.2016', '1');

-- ************************************************************************************************
-- Erstellen von einigen VIEWS (... sind gespeichert SQL Statements) zwecks Auswertung
-- ************************************************************************************************
