-- ************************************************************************************************
-- Tabellen erstellen und Beziehungen festlegen
-- ************************************************************************************************

-- HOTFIX: MySQL haut es (trotz CASCADE), wenn das eigeschalten bleibt. Da eh alles gelöscht wird, ist es so sogar performanter
SET FOREIGN_KEY_CHECKS = 0;

CREATE OR REPLACE TABLE COUNTRY(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(2),
  NAME VARCHAR(255)
);

-- Welche Städte gibt es
CREATE OR REPLACE TABLE CITY(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
  NAME VARCHAR(255),
  FK_Country_ID INT(255)
);

-- Welche Strecken gibt es

CREATE OR REPLACE TABLE TRACK(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  NAME VARCHAR(255),
  LENGTH INT(255),
  FASTEST_LAP TIME(3),
  SEATS INT(255),
  FK_City_ID INT(255)
);

-- Welche Rennen gibt es

CREATE OR REPLACE TABLE RACE(
  ID INT(255) NOT NULL AUTO_INCREMENT,
  LAPS INT(255),
  START_TIME TIME,
  DURATION TIME,
  R_DATE DATE,
  FK_Track_ID INT(255),
  PRIMARY KEY (ID)
);


-- Welche Strecken gibt es

CREATE OR REPLACE TABLE DRIVER(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  FORNAME VARCHAR(255),
  LASTNAME VARCHAR(255),
  DOB DATE,
  WEIGHT INT(255),
  FK_Country_ID INT(255),
  FK_Team_ID INT(255)
);

-- Welche Teams gibt es

CREATE OR REPLACE TABLE TEAM(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
  NAME VARCHAR(255),
  FK_Brand_ID INT(255)
);

-- Welche Marken gibt es

CREATE OR REPLACE TABLE BRAND(
  ID INT(255) AUTO_INCREMENT PRIMARY KEY,
  CODE VARCHAR(255),
  NAME VARCHAR(255)
);

-- Welche Position hat welcher Fahrer bei welchem Rennen erreicht

CREATE OR REPLACE TABLE RACE_TO_DRIVER(
  RACE_ID INT(255) NOT NULL,
  DRIVER_ID INT(255) NOT NULL,
  POSITION INT(255) NOT NULL
);

-- In der Beziehungstabelle dürfen nur IDs vorkommen die es auch gibt
ALTER TABLE CITY ADD FOREIGN KEY (FK_Country_ID) REFERENCES COUNTRY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE TRACK ADD FOREIGN KEY (FK_City_ID) REFERENCES CITY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE RACE ADD FOREIGN KEY (FK_Track_ID) REFERENCES TRACK(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE DRIVER ADD FOREIGN KEY (FK_Country_ID) REFERENCES COUNTRY(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE DRIVER ADD FOREIGN KEY (FK_Team_ID) REFERENCES TEAM(ID) ON DELETE CASCADE ON UPDATE CASCADE;
ALTER TABLE TEAM ADD FOREIGN KEY (FK_Brand_ID) REFERENCES BRAND(ID) ON DELETE CASCADE ON UPDATE CASCADE;

-- Keine Doppelten Einträge
ALTER TABLE RACE_TO_DRIVER ADD CONSTRAINT NO_DUPL_PD UNIQUE (RACE_ID, DRIVER_ID);


SET FOREIGN_KEY_CHECKS = 1;
-- END OF HOTFIX ;)

-- ************************************************************************************************
-- Es ist an der Zeit einige Daten einzufüllen
-- ************************************************************************************************
-- Alle Länder
INSERT INTO COUNTRY (CODE, NAME) VALUES ('DE', 'GERMANY');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('AT', 'AUSTRIA');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('HU', 'HUNGARY');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('NL', 'NETHERLANDS');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('GB', 'GREAT BRITAN');
INSERT INTO COUNTRY (CODE, NAME) VALUES ('RU', 'RUSSIA');

-- Alle Städte
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('HOK','Hockenheim','1');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('SPI','Spielberg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('LAU','Lausitz','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('NUB','Nürnberg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('ZAN','Zandvoort','4');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('MOS','Moscow','6');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('NUR','Nürburg','2');
INSERT INTO CITY (CODE, NAME, FK_Country_ID) VALUES('BUD','Budapest','3');

-- Alle Strecken
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Hockenheimring','4574','00:01:32.532', '120.000', 1);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Red Bull Ring','4574','00:01:32.532', '120.000', 2);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Eurospeedway Lausitz','4574','00:01:32.532', '120.000', 3);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Norisring','4574','00:01:32.532', '120.000', 4);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Zandvoort','4574','00:01:32.532', '120.000', 5);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Moscow Raceway','4574','00:01:32.532', '120.000', 6);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Nürburgring','4574','00:01:32.532', '120.000', 7);
INSERT INTO TRACK (NAME, LENGTH, FASTEST_LAP, SEATS, FK_City_ID) VALUES('Budapest','4574','00:01:32.532', '120.000', 8);

-- Alle Marken
INSERT INTO BRAND (ID, CODE, NAME) VALUES (1, 'MER', 'Mercedes Benz');
INSERT INTO BRAND (ID, CODE, NAME) VALUES (2, 'BMW', 'BMW');
INSERT INTO BRAND (ID, CODE, NAME) VALUES (3, 'AUD', 'Audi');

-- Alle Teams
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ABT', 'Audi Sport Team Abt Sportsline', 3);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('PHO', 'Audi Sport Team Phoenix', 3);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ROS', 'Audi Sport Team Rosberg', 3);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('RBM', 'BMW Team RBM', 2);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('RMG', 'BMW Team RMG', 2);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('MTE', 'BMW Team MTEK', 2);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('SCH', 'BMW Team Schnitzer', 2);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('ART', 'Mercedes-AMG DTM Team ART', 1);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('HWA', 'Mercedes-AMG DTM Team HWA', 1);
INSERT INTO TEAM (CODE, NAME, FK_Brand_ID) VALUES ('MUE', 'Mercedes-AMG DTM Team Mücke', 1);

-- Alle Fahrer: Team Zuweisung, Gewicht und DOB sind zufällig und entsprechen nicht der Realität 14.07.1978
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Lucas', 'Auer', '1978.07.14', '70', 1, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Tom', 'Blomqvist', '1978.07.14', '70', 2, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Mattias', 'Ekström', '1978.07.14', '70', 3, 3);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Augusto', 'Farfus', '1978.07.14', '70', 4, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('António', 'Félix da Costa', '1978.07.14', '70', 5, 5);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Paul', 'Di Resta', '1978.07.14', '70', 1, 6);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Timo', 'Glock', '1978.07.14', '70', 2, 7);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Maximilian', 'Götz', '1978.07.14', '70', 3, 8);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Jamie', 'Green', '1978.07.14', '70', 4, 9);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Daniel', 'Juncadella', '1978.07.14', '70', 5, 10);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Maxime', 'Martin', '1978.07.14', '70', 1, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Miguel', 'Molina', '1978.07.14', '70', 2, 1);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Edoardo', 'Mortara', '1978.07.14', '70', 3, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Nico', 'Müller', '1978.07.14', '70', 4, 3);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Esteban', 'Ocon', '1978.07.14', '70', 5, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Gary', 'Paffett', '1978.07.14', '70', 1, 5);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Mike', 'Rockenfeller', '1978.07.14', '70', 2, 6);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Timo', 'Scheider', '1978.07.14', '70', 3, 7);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Bruno', 'Spengler', '1978.07.14', '70', 4, 8);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Adrien', 'Tambay', '1978.07.14', '70', 5, 9);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Martin', 'Tomczyk', '1978.07.14', '70', 1, 10);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Christian', 'Vietoris', '1978.07.14', '70', 2, 4);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Robert', 'Wickens', '1978.07.14', '70', 3, 2);
INSERT INTO DRIVER (FORNAME, LASTNAME, DOB, WEIGHT, FK_Country_ID, FK_Team_ID) VALUES ('Marco', 'Wittmann', '1978.07.14', '70', 4, 3);


-- Alle Rennen
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (30, '13:30', '00:40:00', '2016.05.01', '1');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (40, '15:00', '01:00:00', '2016.05.02', '1');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (31, '13:30', '00:40:00', '2016.05.20', '2');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (41, '15:00', '01:00:00', '2016.05.21', '2');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (32, '13:30', '00:40:00', '2016.05.30', '3');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (42, '15:00', '01:00:00', '2016.06.01', '3');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (33, '13:30', '00:40:00', '2016.06.21', '4');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (43, '15:00', '01:00:00', '2016.06.22', '4');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (34, '13:30', '00:40:00', '2016.07.10', '5');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (44, '15:00', '01:00:00', '2016.07.11', '5');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (35, '13:30', '00:40:00', '2016.07.28', '6');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (45, '15:00', '01:00:00', '2016.07.19', '6');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (36, '13:30', '00:40:00', '2016.08.05', '7');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (46, '15:00', '01:00:00', '2016.08.06', '7');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (37, '13:30', '00:40:00', '2016.08.25', '8');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (47, '15:00', '01:00:00', '2016.08.26', '8');

INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (30, '13:30', '00:40:00', '2016.09.03', '1');
INSERT INTO RACE (LAPS, START_TIME, DURATION, R_DATE, FK_Track_ID) VALUES (40, '15:00', '01:00:00', '2016.09.04', '1');

-- ************************************************************************************************
-- Erstellen von einigen VIEWS (... sind gespeichert SQL Statements) zwecks Auswertung
-- ************************************************************************************************
